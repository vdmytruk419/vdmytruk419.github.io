<script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>

<input id="fileInput" type="file">
<div id="out"></div>

<style>
    body {
        font-family: Tahoma, sans-serif;
        color: #493628;
    }

    details {
        margin: .5rem 1rem;
    }

    .assignee {
        margin: .5rem 1rem;
    }

    .position {
        background-color: #E4E0E1;
        margin: 1rem;
        padding: 1rem;
    }

    .position em {
        display: inline-block;
        min-width: 20rem;
    }

    .assignee em {
        min-width: 19rem;
    }
</style>
<script>
    const fileInput = document.getElementById('fileInput'); // Your <input type="file"> element
    const out = document.getElementById('out');

    fileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = (e) => {
        const arrayBuffer = e.target.result;
        try {
            const inflated = pako.ungzip(new Uint8Array(arrayBuffer));
            const decoded = new TextDecoder("utf-8").decode(inflated);
            const db = JSON.parse(decoded);
            out.innerHTML = renderUnit(db.root);
        } catch (error) {
        console.error("Error decompressing:", error);
        }
    };

    reader.readAsArrayBuffer(file); // Important: read as ArrayBuffer
    });

    const renderUnit = (unit) => {
        const { name, subUnits, positions } = unit;
        let html = '';

        if (subUnits) {
            html += subUnits.reduce((html, unit) => html + renderUnit(unit.value), '');
        }

        if (positions) {
            html += '<div class="positions">' +
                positions.reduce((html, position) => html + '<div class="position">' + renderPosition(position.value) + '</div>', '') +
                '</div>';
        }

        return `<details><summary>${name.value}</summary><div>${html}</div></details>`;
    }

    const renderPosition = (position) => {
        return Object
            .entries(position)
            .reduce((html, [key, value]) =>
                html + `<div class="${key}"><em>${key}</em> <span>${isObject(value.value) ? renderPosition(value.value) : value.value}</span></div>`, ''
            );
    }

    function isObject(variable) {
        return Object.prototype.toString.call(variable) === "[object Object]" && variable !== null;
    }
</script>